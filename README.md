# çœ¼åº•å›¾åƒé¢„å¤„ç†åŠä¼˜åŒ–å·¥å…·

## é¡¹ç›®èƒŒæ™¯
åŸå§‹çœ¼åº•å›¾åƒï¼ˆç¤ºä¾‹è§ `samples/input/image1.jpg`ï¼‰å­˜åœ¨å¤§é‡æ— æ•ˆé»‘è¾¹åŒºåŸŸã€‚è¿™äº›èƒŒæ™¯åƒç´ ä¸ä»…æ— æ³•ä¸ºçœ¼åº•è¯†åˆ«æä¾›æœ‰æ•ˆä¿¡æ¯ï¼Œå…¶æš—åŒºå™ªå£°è¿˜å¯èƒ½å¯¹åç»­åˆ†æäº§ç”Ÿå¹²æ‰°ã€‚æœ¬å·¥å…·é€šè¿‡è‡ªåŠ¨æå–çœ¼åº•å›¾åƒçš„åœ†å½¢æœ‰æ•ˆè§†é‡åŒºåŸŸï¼ˆCircular Field of View, FOVï¼‰ï¼Œå®ç°ç²¾å‡†çš„é¢„å¤„ç†æ“ä½œã€‚ç»ç®—æ³•ä¼˜åŒ–åï¼Œå•å›¾å¤„ç†è€—æ—¶ä» 3 ç§’é™ä½è‡³ 0.6 ç§’ï¼Œåœ¨ä¿æŒåˆ‡å‰²ç²¾åº¦çš„åŒæ—¶å®ç° 5 å€æ•ˆç‡æå‡ã€‚

## åŠŸèƒ½ç‰¹æ€§
- âš¡ **é«˜æ•ˆå¤„ç†**ï¼šæ”¯æŒæ‰¹é‡å¤„ç†çœ¼åº•å›¾åƒï¼ˆå·¦/å³çœ¼ï¼‰
- â­• **ç²¾å‡†è¯†åˆ«**ï¼šåŸºäºåœ†å½¢æ£€æµ‹ç®—æ³•ï¼Œå‡†ç¡®æå–æœ‰æ•ˆè§†é‡åŒºåŸŸ
- ğŸ”„ **å®¹é”™æœºåˆ¶**ï¼šè‡ªåŠ¨é‡è¯•æœºåˆ¶+åŸå§‹æ–‡ä»¶ä¿ç•™ç­–ç•¥ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§
- ğŸ“Š **æ•°æ®è¿½æº¯**ï¼šè‡ªåŠ¨ç”Ÿæˆå¤„ç†æ—¥å¿—ä¸ CSV å…ƒæ•°æ®è®°å½•

## æŠ€æœ¯æ–¹æ¡ˆ

### å®ç°åŸç†
é‡‡ç”¨åŸºäº OpenCV çš„ä¼ ç»Ÿå›¾åƒå¤„ç†æµç¨‹ï¼š
1. **ç°åº¦è½¬æ¢**ï¼šå°† RGB å›¾åƒè½¬ä¸ºç°åº¦ç©ºé—´
2. **é«˜æ–¯æ¨¡ç³Š**ï¼š5x5 æ ¸é™å™ªå¤„ç†ï¼ˆÏƒ=0ï¼‰
3. **è¾¹ç¼˜æ£€æµ‹**ï¼šCanny ç®—å­ï¼ˆ50/150 é˜ˆå€¼ï¼‰
4. **åœ†å½¢æ‹Ÿåˆ**ï¼šHough æ¢¯åº¦æ³•æ£€æµ‹æœ€å¤§åœ†å½¢è½®å»“
5. **åŒºåŸŸæ‰©å±•**ï¼šæŒ‰æ£€æµ‹åŠå¾„ 120% æ¯”ä¾‹æ‰©å±•é«˜åº¦

### æ€§èƒ½ä¼˜åŒ–
| æŒ‡æ ‡         | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|--------------|--------|--------|----------|
| å•å›¾è€—æ—¶     | 3.0s   | 0.3s   | 10å€      |
| å¤„ç†æˆåŠŸç‡   | 92%    | 95%    | +3%      |
| CPUåˆ©ç”¨ç‡    | 35%    | 68%    | +94%     |

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
```bash
Python == 2.7.x
OpenCV == 3.1.0  # éœ€ç¡®ä¿ import cv2 å¯ç”¨
numpy == 1.12.1
pandas >= 0.19.2
```

### æ‰§è¡Œå¤„ç†
- **å•å¼ æµ‹è¯•ï¼ˆå¼€å‘æ¨¡å¼ï¼‰**
  ```bash
  python demo.py --input samples/input.jpg --output results/
  ```

- **æ‰¹é‡å¤„ç†ï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰**
  ```bash
  python run.py --config config.yaml
  ```

### å¤„ç†æ•ˆæœ
<img src="https://github.com/poboll/retina-fov-cutter/raw/main/path/out/å®éªŒæ•ˆæœ.png" width="80%" height="80%"></img>  

### ä¼˜åŒ–æ€è·¯
<img src="https://github.com/poboll/retina-fov-cutter/raw/main/path/out/ä¼˜åŒ–.png" width="80%" height="80%"></img>   

### ä¼˜åŒ–æ•ˆæœ
<img src="https://github.com/poboll/retina-fov-cutter/raw/main/path/out/ä¼˜åŒ–å¯¹æ¯”.png" width="80%" height="80%"></img>

## è¿›é˜¶é…ç½®
é€šè¿‡ä¿®æ”¹ `config.yaml` é…ç½®æ–‡ä»¶å®ç°ä¸ªæ€§åŒ–è®¾ç½®ï¼š

```yaml
processing:
  retry_attempts: 3       # å¤±è´¥é‡è¯•æ¬¡æ•°
  extension_ratio: 1.2     # é«˜åº¦æ‰©å±•æ¯”ä¾‹
  min_radius: 256         # æœ€å°æœ‰æ•ˆåŠå¾„ï¼ˆpxï¼‰

io:
  input_dir: /data/raw     # åŸå§‹å›¾åƒç›®å½•
  output_dir: /data/processed  # ç»“æœå­˜å‚¨ç›®å½•
  log_file: processing.log # æ—¥å¿—æ–‡ä»¶è·¯å¾„
```

### æ•°æ®ç®¡ç†
å¤„ç†å®Œæˆåï¼Œç³»ç»Ÿå°†ç”Ÿæˆä»¥ä¸‹ç»“æ„åŒ–æ–‡ä»¶ï¼š

```
â”œâ”€â”€ processed/            # å¤„ç†åçš„å›¾åƒ
â”‚   â”œâ”€â”€ patient_001/
â”‚   â”‚   â”œâ”€â”€ left.jpg
â”‚   â”‚   â””â”€â”€ right.jpg
â”œâ”€â”€ logs/
â”‚   â””â”€â”€ processing.log     # å¤„ç†æ—¥å¿—ï¼ˆå«é”™è¯¯è®°å½•ï¼‰
â””â”€â”€ metadata.csv          # åŒ…å«å¤„ç†åçš„æ–‡ä»¶è·¯å¾„ä¿¡æ¯
```

## è®¸å¯åè®®
MIT